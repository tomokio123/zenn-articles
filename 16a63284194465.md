---
title: "[Flutter]FutureProviderã¨StreamProviderã®å€‹äººçš„ã¾ã¨ã‚"
emoji: "ğŸ™†"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Flutter","Dart"]
published: true
---
æ³¨æ„ï¼šå…¬å¼ã‚’è¦‹ã‚‹ã®ãŒä¸€ç•ªã§ã™ã®ã§ãã¡ã‚‰ã‚‚è¦‹ã¦ãã ã•ã„ï¼
[å…¬å¼è¨˜äº‹](https://riverpod.dev/ja/docs/providers/future_provider)
[å‚è€ƒè¨˜äº‹](https://terupro.net/flutter-future-provider-sample)
[å‚è€ƒè¨˜äº‹](https://terupro.net/flutter-stream-provider-sample)
# FutureProvider
FutureProviderã¨ã¯
- #### ã€Œå˜ä¸€ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã€ã«ãŠã„ã¦ã€ã€ŒéåŒæœŸæ“ä½œã€ãŒå¯èƒ½ãª Provider
ã§ã‚ã‚‹ã€‚
( **ã€Œæ–­ç¶šçš„ã«ã€ã§ã¯ãªãã€ã€Œä¸€å›é™ã‚Šã€** ã§éåŒæœŸã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹)
## ä½¿ã„æ‰€
- **éåŒæœŸæ“ä½œã‚’å®Ÿè¡Œã—ã€ãã®ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã‚Šå€¤ã«ã™ã‚‹ã¨ã**ã€‚
- éåŒæœŸæ“ä½œã® error/loading ã‚¹ãƒ†ãƒ¼ãƒˆã‚’é©åˆ‡ã«å‡¦ç†ã™ã‚‹ã¨ãã€‚
- éåŒæœŸçš„ã«å–å¾—ã—ãŸè¤‡æ•°ã®å€¤ã‚’çµ„ã¿åˆã‚ã›ã¦ä¸€ã¤ã®å€¤ã«ã™ã‚‹ã¨ãã€‚

## sample code(+Points)
ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã¨3ç§’å¾Œã«ã€ŒHello Worldã€ã‚’å–å¾—ã™ã‚‹ç°¡å˜ãªã‚¢ãƒ—ãƒª
```dart:main.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

void main() {
  // â‘ ProviderScopeã§ãƒ©ãƒƒãƒ—ã™ã‚‹
  runApp(const ProviderScope(child: MyApp()));
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      title: 'FutureProvider',
      theme: ThemeData(
        textTheme: const TextTheme(bodyText2: TextStyle(fontSize: 50)),
      ),
      home: HomePage(),
    );
  }
}

// â‘¡FutureProviderã®ä½œæˆ (å˜ä¸€ã®ãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸã§å–å¾—ã™ã‚‹)
final futureProvider = FutureProvider<dynamic>((ref) async {
  await Future.delayed(const Duration(seconds: 3));
  return 'Hello World';
});

// â‘¢FutureProviderã‚’ä½œæˆã™ã‚‹ã¨ã€ŒAsyncValueã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã§ãã‚‹
//ã€ŒAsyncValueã€ã¯éåŒæœŸé€šä¿¡ã®é€šä¿¡ä¸­ã€é€šä¿¡çµ‚äº†ã€ç•°å¸¸çµ‚äº†å‡¦ç†ã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦ãã‚Œã‚‹Riverpodã®ä¾¿åˆ©ãªæ©Ÿèƒ½ã®ã“ã¨

class HomePage extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // â‘¢AsyncValueã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ã™ã‚‹
    final asyncValue = ref.watch(futureProvider);
    return Scaffold(
      appBar: AppBar(title: const Text('Hallo World')),
      floatingActionButton: FloatingActionButton(
        child: const Icon(Icons.refresh),
        onPressed: () {
          // â‘£æŠ¼ä¸‹ã™ã‚‹ã¨çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹å‡¦ç†
          ref.refresh(futureProvider);
        },
      ),
      body: Center(
        child: asyncValue.when(//â‘¤ AsyncValueã®çŠ¶æ…‹åˆ¥ã«è¿”ã‚Šå€¤ã‚’åˆ†å²æŒ‡å®šã™ã‚‹ã€‚
          error: (err, _) => Text(err.toString()), //ã‚¨ãƒ©ãƒ¼æ™‚ => ã‚¨ãƒ©ãƒ¼æ–‡ã‚’å‡ºåŠ›
          loading: () => const CircularProgressIndicator(), //èª­ã¿è¾¼ã¿æ™‚ã€€=> ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã‚’è¡¨ç¤º
          data: (data) => Text(data.toString()), //ãƒ‡ãƒ¼ã‚¿å—ã‘å–ã‚Šæ™‚ã€€=> ãƒ‡ãƒ¼ã‚¿ã‚’Stringå¤‰æ›ã—ã¦è¡¨ç¤º
        ),
      ),
    );
  }
}
```
## Points
- â‘ ï¼šProviderScopeã§ãƒ«ãƒ¼ãƒˆ(ä¸€ç•ªåŸå§‹ã®)widgetã‚’ãƒ©ãƒƒãƒ—
ã“ã‚Œã«ã‚ˆã‚Šå¤‰æ›´ã‚’è¿½ãˆã‚‹
- â‘¡ï¼šFutureProviderã®å®šç¾©ã€‚(è¨­ç½®ã€‚**å˜ä¸€ã®ãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸã§å–å¾—**ã™ã‚‹)
futureProvider ã®ä¸­ã«ã€éåŒæœŸã§å–å¾—ã—ãŸã„å˜ä¸€ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ã‚ˆã†ã«ã—ãŸã€‚
- â‘¢ï¼šFutureProviderã‚’ä½œæˆã™ã‚‹ã¨ã€Œ**AsyncValue**ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’(returnã¨ã—ã¦)ç”Ÿæˆã§ãã‚‹ã€‚éåŒæœŸé€šä¿¡ã®é€šä¿¡ä¸­ã€é€šä¿¡çµ‚äº†ã€ç•°å¸¸çµ‚äº†å‡¦ç†ã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦ãã‚Œã‚‹Riverpodã®ä¾¿åˆ©ãªæ©Ÿèƒ½ã€‚
`ref.watch(å¼•æ•°)`ã§(å¼•æ•°)ã®éƒ¨åˆ†ã‚’ç›£è¦–(ãƒªãƒƒã‚¹ãƒ³)ã—ã¦ã€å¤‰æ›´ãŒã‚ã‚Œã°ã€€**FutureProvider ã‚’ç›£è¦–ã—ãŸéš›ã®æˆ»ã‚Šå€¤**ã¨ã—ã¦è¿”ã™ã€‚
- â‘£ï¼šã“ã® `ref.refresh(futureProvider)` ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚Š(futureProvider ã®ä¸­ã®) StateController **ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å†åº¦ç”Ÿæˆã•ã‚Œã‚‹**ã€‚**çŠ¶æ…‹ã‚’æ›´æ–°**ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å†ç”Ÿæˆã—ã€çŠ¶æ…‹æ›´æ–°ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚
- â‘¤ï¼šéåŒæœŸå‡¦ç†ã§ã¯AsyncValueã‚’ä½¿ç”¨ã—ã¦ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã®å€¤ã‚‚è¿”ã™å¿…è¦ãŒã‚ã‚Šã€å…ˆã»ã©å®šç¾©ã—ãŸfutureã«**whenã‚’ä½¿ç”¨ã—ã¦AsyncValueã®çŠ¶æ…‹åˆ¥ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã§æˆ»ã‚Šå€¤ã‚’æŒ‡å®š**ã™ã‚‹ã€‚


![](https://terupro.net/wp-content/uploads/2022/05/Simulator-Screen-Recording-iPhone-13-2022-05-23-at-15.46.01.gif)

# StreamProvider

StreamProviderã¨ã¯
- #### ã€Œæ–­ç¶šçš„ãªãƒ‡ãƒ¼ã‚¿å–å¾—ã€ã«ãŠã„ã¦ã€ã€ŒéåŒæœŸæ“ä½œã€ãŒå¯èƒ½ãª Provider
ã§ã‚ã‚‹ã€‚

## sample code(+Points)

```dart:main.dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

void main() {
  // ProviderScopeã§ãƒ©ãƒƒãƒ—ã™ã‚‹
  runApp(const ProviderScope(child: MyApp()));
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      title: 'Count Down',
      theme: ThemeData(
        textTheme: const TextTheme(bodyText2: TextStyle(fontSize: 50)),
      ),
      home: HomePage(),
    );
  }
}

// StreamProviderã®ä½œæˆ (ãƒ‡ãƒ¼ã‚¿ã‚’éåŒæœŸã§æ–­ç¶šçš„ã«å–å¾—ã™ã‚‹)
final streamProvider = StreamProvider<dynamic>((ref) {
  Stream<dynamic> getNumbers() async* {
    await Future.delayed(const Duration(seconds: 1));
    yield 'Are You Ready?';

    await Future.delayed(const Duration(seconds: 1));
    yield 3;

    await Future.delayed(const Duration(seconds: 1));
    yield 2;

    await Future.delayed(const Duration(seconds: 1));
    yield 1;

    await Future.delayed(const Duration(seconds: 1));
    yield '';
  }

  return getNumbers();
});

// StreamProviderã‚’ä½œæˆã™ã‚‹ã¨ã€ŒAsyncValueã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã§ãã‚‹
//ã€ŒAsyncValueã€ã¯éåŒæœŸé€šä¿¡ã®é€šä¿¡ä¸­ã€é€šä¿¡çµ‚äº†ã€ç•°å¸¸çµ‚äº†å‡¦ç†ã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦ãã‚Œã‚‹Riverpodã®ä¾¿åˆ©ãªæ©Ÿèƒ½ã®ã“ã¨

class HomePage extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // AsyncValueã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ã™ã‚‹
    final asyncValue = ref.watch(streamProvider);
    return Scaffold(
      appBar: AppBar(title: const Text('Count Down')),
      floatingActionButton: FloatingActionButton(
        child: const Icon(Icons.refresh),
        onPressed: () {
          // çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹
          ref.refresh(streamProvider);
        },
      ),
      body: Center(
        child: asyncValue.when(
          error: (err, _) => Text(err.toString()), //ã‚¨ãƒ©ãƒ¼æ™‚
          loading: () => const CircularProgressIndicator(), //èª­ã¿è¾¼ã¿æ™‚
          data: (data) => Text(data.toString()), //ãƒ‡ãƒ¼ã‚¿å—ã‘å–ã‚Šæ™‚
        ),
      ),
    );
  
```

## Points
- `final streamProvider = StreamProvider`ã§StreamBuilderã‚’å®šç¾©ã€‚

# FutureProviderr ã¨ StreamProviderã®é•ã„
- FutureProviderï¼šã€Œ**å˜ä¸€ã®ãƒ‡ãƒ¼ã‚¿å–å¾—**ã€ã«ä½¿ã†
- StreamProviderï¼šã€Œ**æ–­ç¶šçš„ãªãƒ‡ãƒ¼ã‚¿å–å¾—**ã€ã«ä½¿ã†

ã¾ã‚Futureã¨Streamã®é•ã„ã‚‚å˜ä¸€ã®å¤‰æ•°ã‚’æ‰±ã†ã¨ããƒ»Listã¿ãŸã„ã«è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã¨ãã£ã¦é•ã„ã ã‹ã‚‰ã€ã“ã®é•ã„ã‚‚æ™®é€šãªæ„Ÿã˜ã‚‚ã™ã‚‹ã€‚
æ¬¡ã¯Futureã¨Streamã®é•ã„ã«ã¤ã„ã¦èª¿ã¹ã‚ˆã€œ

<br>
ã¾ã ã¾ã å…¨ç„¶ç†è§£ã—ã¦ã„ãªã„ã§ã™ãŒã€ä»Šå›ã¯ä»¥ä¸Šã§ã™ã€‚é–“é•ãˆãŒè¦‹ã¤ã‹ã‚Šæ¬¡ç¬¬ã€æˆ–ã„ã¯çŸ¥è­˜ãŒã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œæ¬¡ç¬¬æ”¹è¨‚ã—ã¦ã„ãã¾ã™ã€‚ğŸ™



