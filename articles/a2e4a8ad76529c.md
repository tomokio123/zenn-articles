---
title: "„ÄêLaravel„ÄëÊúÄËøëÂ≠¶„Çì„Å†Ë™çË®º„Å´„Å§„ÅÑ„Å¶„ÅÆ„Åæ„Å®„ÇÅ"
emoji: "üìå"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: ["Laravel", "PHP"]
published: true
---

# ÊúÄËøëÂ≠¶„Çì„Å†Ë™çË®ºÈñ¢ÈÄ£„ÅÆ„Éï„Ç°„Ç§„É´„Å´„Å§„ÅÑ„Å¶„ÅÆ„Åæ„Å®„ÇÅ
Breeze„Çí‰Ωø„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇLravel10.x„Åß„Åô
„Éì„ÇÆ„Éä„Éº„Å´„Çà„Çã„É°„É¢„ÅßÈõë„Åß„Åô„Çì„Åæ„Åõ„Çì
## ÂêÑ„ÄÖÁ¢∫Ë™ç
Á¢∫Ë™ç„Åô„Çã„Éï„Ç°„Ç§„É´„Åü„Å°„ÄÇ
- Authenticated.php(Middleware/)
- RedirectIfAuthenticated.php(Middleware/)
- RouteServiceProvider.php(app/Providers)
- web.php&auth.php(routes)
- AuthenticatedSessionController.php(Http/Controllers/User/Auth)
- TaskController.php(„É≠„Ç∞„Ç§„É≥Ë™çË®ºÊôÇ„ÅÆ„É´„Éº„Éà„Éª„Ç≥„É≥„Éà„É≠„Éº„É©)
### Authenticated.php(=Êú™Ë™çË®º„ÇØ„É©„Ç§„Ç¢„É≥„Éà„ÅãÔºü„ÅÆÊ§úË®º„Çí„Åó„ÄÅ„É´„Éº„Éà„ÇíÂàÜÂ≤ê„Åï„Åõ„Çã) „ÇíÁ¢∫Ë™ç
- `protected $user_route = "user.login";`„Å®„Åó„Å¶„ÅÑ„Çã„Åì„Å®„ÅßUPL„Ååuser„ÅÆ„Å®„Åç„ÅØuser.**login**„ÇíËøî„Åó„Å¶„ÅÇ„Åí„Çã
```php:Authenticated.php
use Illuminate\Support\Facades\Route;
class Authenticate extends Middleware
{
    //TODO: RouteServiceProvider„ÅßÂÆöÁæ©„ÄÇRouteServiceProvider„Åßas„Å´„Çà„Å£„Å¶user„ÅØ"user."„Å®ÂÖàÈ†≠„Å´„Å§„Åë„Çã„Åì„Å®„ÇíÊ±∫„ÇÅ„Åü„ÅÆ„ÅßÂÖàÈ†≠„Å´user.„Çí„Å§„Åë„Åü
    protected $user_route = "user.login"; //Êú™Ë™çË®º„Å™„Çâroute„Çílogin„Å´Ëøî„Åô„Åì„Å®„ÇíÊ±∫„ÇÅ„Çã
    // * Êú™Ë™çË®º„ÅÆÂ†¥Âêà„ÅÆ„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
    protected function redirectTo(Request $request): ?string
    {
        if (! $request->expectsJson()) {
          //„É´„Éº„Éà„Ååuser„ÅÆ„Å®„Åç„ÅØuser.login„ÇíËøî„Åó„Å¶„ÅÇ„Åí„Çã
            if(Route::is("user.*")){
                return route($this->user_route);
            }
        }
    }
}
```

### RouteServiceProvider.php„ÅÆÂÆöÁæ©„ÇíÁ¢∫Ë™ç(=ÂúüÂè∞„Å®„Å™„ÇãrouteËá™‰Ωì„ÇíÂÆöÁæ©„Åô„Çã)
- „Äå/„Äç„Åå„Å§„ÅÑ„Åü„Çâ„Äåuser„Äç„Å®„Åó„Å¶Ë™çË≠ò„Åô„Çã„ÄÇ„Åì„Çå‰ª•Èôç„ÅØ„É≠„Ç∞„Ç§„É≥„Åï„Çå„Å¶„ÅÑ„Çã„Åã„Å©„ÅÜ„Åã„ÅßÊåôÂãï„ÇíÂà∂Âæ°„Åô„Çã
- routes/web.php„Å´Ë©≥„Åó„ÅÑÂà∂Âæ°„ÇíÊõ∏„Åè
```php:RouteServiceProvider.php
use Illuminate\Support\Facades\Route;
class RouteServiceProvider extends ServiceProvider
{
    public const HOME = '/';
    public function boot(): void
    {//Ëâ≤„ÄÖÂâ≤ÊÑõ
        $this->routes(function () {
            // POINT:„Äå/„Äç„Åå„Å§„ÅÑ„Åü„Çâ„Äåuser„Äç„Å®„Åó„Å¶Ë™çË≠ò„Åô„Çã„ÄÇ„Åì„Çå‰ª•Èôç„ÅØ„É≠„Ç∞„Ç§„É≥„Åï„Çå„Å¶„ÅÑ„Çã„Åã„Å©„ÅÜ„Åã„ÅßÊåôÂãï„ÇíÂà∂Âæ°„Åô„Çã
            Route::prefix("/")
            ->as("user.")
            ->middleware("web")//„Åì„ÅÆ„Éü„Éâ„É´„Ç¶„Ç®„Ç¢„ÅØÂü∫Êú¨web/api„Åß„Åô.„Ç´„Çπ„Çø„É†„Åô„Çã„Å™„ÇâKernel„Å™„Å©„Å´ËøΩË®ò„Åó„Çç)(https://readouble.com/laravel/8.x/ja/middleware.html)
            ->namespace($this->namespace)
            ->group(base_path("routes/web.php"));
        });
    }
}
```
### routes/web.php „ÇíÁ¢∫Ë™ç
- **user„ÅßË™çË®º„Åó„Å¶„ÅÑ„Åü„Çâ/„ÅßTaskController„ÅÆ, 'index'„ÇíË¶ã„Å´„ÅÑ„Åè**„ÄÇ
- Ë™çË®º„Åó„Å¶„ÅÑ„Å™„Åã„Å£„Åü„Çâguest„ÅÆget::('login')„ÅÇ„Åü„Çä„ÅåÂëº„Å∞„Çå„Çã„ÅÆ„Åß**AuthenticatedSessionController„ÇíË¶ã„Å´Ë°å„Åè**
```php:web.php
//Ëâ≤„ÄÖÂâ≤ÊÑõ
Route::get('/', function () {
    return view('user.main');
});

Route::middleware("auth:users")->group(function(){
    // toÂïÜÂìÅ‰∏ÄË¶ß
    Route::get("/", [TaskController::class, 'index'])->name('tasks.index');
});
require __DIR__.'/auth.php';
```
```php:route/auth.php
//„Ç≤„Çπ„Éà„É¶„Éº„Ç∂„Éº
Route::middleware('guest')->group(function () {
    //„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Å™„ÅÑ„É¶„Éº„Ç∂„Éº„ÅØKernel.php„Çà„Çä„ÄÅ\App\Http\Middleware\RedirectIfAuthenticated,„Å´Á¥ê„Å•„ÅÑ„Å¶„ÅÑ„Çã
    Route::get('login', [AuthenticatedSessionController::class, 'create'])
                ->name('login');//AuthenticatedSessionController„ÅÆcreate„É°„ÇΩ„ÉÉ„Éâ„ÇíË¶ã„Çã

    Route::post('login', [AuthenticatedSessionController::class, 'store']);
});

Route::middleware('auth:users')->group(function () {
  //„Åî„ÇäÂâ≤ÊÑõ
});
```
### TaskController.php „Åß„É≠„Ç∞„Ç§„É≥ÊâøË™çÊôÇ„Å´„Åì„Åì„Å´È£õ„Å∞„Åï„Çå„Åü„Å®„Åç„Å´ÊåôÂãï„ÇíÂà∂Âæ°
- `__construct()`„Å´„Éü„Éâ„É´„Ç¶„Ç®„Ç¢„ÇíÂôõ„Åæ„Åõ„Çã„Åì„Å®„Åß„ÄÅ„Åì„ÅÆ„Ç≥„É≥„Éà„É≠„Éº„É©„Çí‰Ωø„ÅÜÈöõ„Å´ÂøÖ„Åö„Ç¨„Éº„Éâ„ÅåÂÖ•„Çã„Çà„ÅÜ„Å´„Å™„Çã
```php:TaskController.php
class TaskController extends Controller
{
    public function __construct()
    {
        $this->middleware("auth:users");//user„É≠„Ç∞„Ç§„É≥„Å´Èôê„Çã

        $this->middleware(function ($request, $next) {
            return $next($request);
        });
    }

    public function index()
    {
        return view("user.index");
    }
}
```

### AuthenticatedSessionController.php ‚Üíget„ÅÆÊôÇ„ÅÆ„É´„Éº„Éà„ÅßÊåáÂÆö„Åï„Çå„Åü„Ç≥„É≥„Éà„É≠„Éº„É©„ÇíÁ¢∫Ë™ç
- `return view('user.auth.login');`:resources/views/User/login.blade.phpË°®Á§∫
```php:AuthenticatedSessionController.php
class AuthenticatedSessionController extends Controller
{
    /**
     * Display the login view.
     */
    public function create(): View
    {
        return view('user.auth.login');
    }
```

### RedirectIfAuthenticated.php „ÅßË™çË®ºÊ∏à„Åø„É¶„Éº„Ç∂„Éº„Åã„Å©„ÅÜ„ÅãË¶ã„Å¶Ë™çË®º„Åï„Çå„Å¶„ÅÑ„Åü„ÇâRouteServiceProvider„ÅßÂÆöÁæ©„Åó„Åü„Å®„Åì„Çç„Åæ„ÅßÈ£õ„Å∞„Åô
```php:RedirectIfAuthenticated.php
//TODO: „É≠„Ç∞„Ç§„É≥Ê∏à„Åø„É¶„Éº„Ç∂„Éº„Åå„Ç¢„ÇØ„Çª„Çπ„Åó„Å¶„Åç„Åü„Çâ„É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÂá¶ÁêÜ
class RedirectIfAuthenticated
{
    private const GUARD_USER = "users";
    public function handle(Request $request, Closure $next, string ...$guards): Response
    {
        // * „É¶„Éº„Ç∂„Éº„Å®„Åó„Å¶Ë™çË®º„Åï„Çå„Å¶„ÅÑ„Åü„Çâ(check()„É°„ÇΩ„ÉÉ„Éâ„ÅßÂà§ÂÆö)„ÄÅ„Åã„Å§„ÄÅ„É™„ÇØ„Ç®„Çπ„Éà„Åå"user.*"„ÅÆURL„Å†„Å£„Åü„Çâ
        if(Auth::guard(self::GUARD_USER)->check() && $request->routeIs("user.*")){
            return redirect(RouteServiceProvider::HOME); //HOME„Å∏ÈÅ∑Áßª„Åß„Åç„Çã
        }
        return $next($request);
    }
}
```
