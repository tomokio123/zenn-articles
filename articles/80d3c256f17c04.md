---
title: "ã€Flutterã€‘ãƒ©ãƒ³ãƒ€ãƒ ã«å•é¡Œã‚’10å€‹å–ã£ã¦ãã¦æŠœãæ‰“ã¡ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹ãƒšãƒ¼ã‚¸ã®å®Ÿè£…"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Flutter","Dart"]
published: true
---
# ã‚„ã‚ŠãŸã„ã“ã¨
- ãƒ©ãƒ³ãƒ€ãƒ ã«æŠœãæ‰“ã¡ãƒ†ã‚¹ãƒˆã‚’ã—ãŸã„ã€‚**å…¨å•é¡Œã‹ã‚‰10å€‹é¸ã‚“ã§å‡ºé¡Œ**ã™ã‚‹ã€‚
firebaseã«ã¯ãƒ©ãƒ³ãƒ€ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã‚‹å‡¦ç†ã¯ç„¡ã„ï¼Ÿã‚ˆã†ãªã®ã§ã€

1. #### ã“ã®ãƒšãƒ¼ã‚¸ãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ãŸã³ã«Dartå´ã§ã€Œå…¨å•é¡Œæ•°ã‹ã‚‰10å•takeã™ã‚‹ã€å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹
2. #### ãã®å‡¦ç†ã§å¾—ãŸç•ªå·ã¨åŒã˜question_idã‚’questionsã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰Queryæ¤œç´¢ã¨ã—ã¦(whereãƒ¡ã‚½ãƒƒãƒ‰)å–ã£ã¦ãã‚‹ã€‚(å•é¡Œã¯Questionsã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³(ãƒ†ãƒ¼ãƒ–ãƒ«)ã«æŒãŸã›ã‚‹)

ã£ã¦æ„Ÿã˜ã«ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã”æ„è¦‹ã‚ã‚Œã°æ•™ãˆã¦ã„ãŸã ããŸã„ã§ã™

## å€‹äººçš„ãƒã‚¤ãƒ³ãƒˆ
- å…¨å•é¡Œæ•°ã¯ã“ã®ãƒšãƒ¼ã‚¸ã«é£›ã‚“ã§ãã‚‹éš›ã«ã™ã§ã«æ¸¡ã—ã¦ã„ã‚‹çŠ¶æ…‹ã«ã—ãŸã„
```dart:unannounced_test_page.dart
class UnannouncedTestPage extends StatelessWidget {
  final int totalNumberOfQuestions;//questionsãƒ†ãƒ¼ãƒ–ãƒ«ã®å…¨å•é¡Œæ•°ã‚’å–å¾—
  //ã“ã®ãƒšãƒ¼ã‚¸ã«é£›ã‚“ã§ãã‚‹æ™‚ã«Firebaseã‹ã‚‰å…¨å•é¡Œæ•°ã‚’å–å¾—ã€‚
```

- å…¨å•é¡Œå†…ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ç”Ÿæˆã—ã¦10å€‹ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã¶å‡¦ç†(takeãƒ¡ã‚½ãƒƒãƒ‰)
```dart:unannounced_test_page.dart
@override
  Widget build(BuildContext context) {
    final List <String> randomNumberList = [];// ãƒ©ãƒ³ãƒ€ãƒ ãª"æ•°å­—"ã‚’æ ¼ç´ã™ã‚‹é…åˆ—
    for (var i = 1; i < totalNumberOfQuestions + 1; i++) {//å…¨å•é¡Œæ•°åˆ†ã ã‘è¶³ã—ã¦ã„ãã€‚
    //["1", "2", "3", "4", "5".....]çš„ãªæ„Ÿã˜ã€‚ã‚ãã¾ã§æ•°å­—ã‚‚æ–‡å­—åˆ—ã«ã—ã¦ã„ã‚‹ãŒã“ã‚Œã«é–¢ã—ã¦ã¯è¨­è¨ˆãƒŸã‚¹ã‹ãªã‚ã€‚ã€‚
      randomNumberList.add("$i");
    }
    randomNumberList.shuffle();// ä¸Šã®ãƒªã‚¹ãƒˆã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦ä¸¦ã³æ›¿ãˆã‚‹(ã“ã“ã§å¯“æ„æ€§ã‚’ç¢ºç«‹ã•ã›ã¦ã„ã‚‹ã€‚ã¤ã‚‚ã‚Šã§ã‚ã‚‹)
    final List<String> gotRandomNumberList = randomNumberList.take(10).toList();//ã“ã“ã§å…ˆé ­ã‹ã‚‰10å€‹å–ã‚Šå‡ºã—ã¦æ–°ã—ã„Listã¨ã™ã‚‹ã€‚
    //toListãŒãªã„ã¨Iterableå‹ã«ãªã‚‹(ã¯ãš)ãªã®ã§toListãƒ¡ã‚½ãƒƒãƒ‰ã§Listå‹ã«ã—ã¦ãŠã
```

- ãƒ©ãƒ³ãƒ€ãƒ ã«ä½œã£ãŸListã‚’å«ã‚€ã‚‚ã®ã‚’å–ã£ã¦ãã¦Futuremã¨ã™ã‚‹ã€‚(å¾Œã§FutureBuilderã®futureãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«æ¸¡ã™)
```dart:unannounced_test_page.dart
//ãƒ©ãƒ³ãƒ€ãƒ ã«ä½œã£ãŸListã‚’å«ã‚€ã‚‚ã®ã‚’å–ã£ã¦ãã¦è¡¨ç¤º
    final questionFuture = QuestionFireStore.questions.where("question_id", whereIn: gotRandomNumberList).get();
    final answerFuture = AnswerFireStore.answers.where('answer_id', whereIn: gotRandomNumberList).get();
```
***
â†“ãã‚Œä»¥å¤–ã®ã¨ã“ã‚ã¯ä»Šå›é‡è¦ã§ã¯ãªã„ã®ã§è¦‹ã›ã¦ãŠãã ã‘ã«ã—ã¾ã™â†“
# ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
```dart:unannounced_test_page.dart
import 'ã„ã£ã±ã„ã‚ã‚‹ãŒå‰²æ„›';
class UnannouncedTestPage extends StatelessWidget {
  final int totalNumberOfQuestions;//questionsãƒ†ãƒ¼ãƒ–ãƒ«ã®å…¨å•é¡Œæ•°ã‚’å–å¾—
  //ã“ã®ãƒšãƒ¼ã‚¸ã«é£›ã‚“ã§ãã‚‹æ™‚ã«Firebaseã‹ã‚‰å…¨å•é¡Œæ•°ã‚’å–å¾—ã€‚
  const UnannouncedTestPage({Key? key, required this.totalNumberOfQuestions})
      : super(key: key);

  @override
  Widget build(BuildContext context) {
    final Size size = MediaQuery.of(context).size;
    final List <String> randomNumberList = [];// ãƒ©ãƒ³ãƒ€ãƒ ãª"question_id"ã‚’æ ¼ç´ã™ã‚‹é…åˆ—

    for (var i = 1; i < totalNumberOfQuestions + 1; i++) {
      //iã¯ç·å•é¡Œæ•°(totalNumberOfQuestions)å€‹åˆ†ã€‚
      randomNumberList.add("$i");
    }
    randomNumberList.shuffle();
    final List<String> gotRandomNumberList = randomNumberList.take(10).toList();

    final questionFuture = QuestionFireStore.questions.where("question_id", whereIn: gotRandomNumberList).get();
    final answerFuture = AnswerFireStore.answers.where('answer_id', whereIn: gotRandomNumberList).get();

    return Scaffold(
      body: Consumer(builder: (context, ref, child){
        return Center(
          child: SafeArea(
            child: FutureBuilder<QuerySnapshot>(
                future: questionFuture,
                builder: (context, snapshot) {
                  //ç¾åœ¨ã®å•é¡Œã®Indexã‚’ç®¡ç†ã€‚å•é¡Œã®ç•ªæ•°ã¯ã“ã‚Œ+1ã€‚
                  final int currentQuestionIndex = ref.watch(currentQuestionIndexProvider);
                  final bool isAnswered = ref.watch(buttonProvider);//å›ç­”ã—ãŸã‹
                  final bool isCorrect = ref.watch(isCorrectProvider);//æ­£è§£orä¸æ­£è§£
                  if(snapshot.hasData){//ã“ã‚Œå¿˜ã‚Œã‚‹ã¨ã€Œnull check Operatorã€ã®ä¾‹å¤–åã‹ã‚Œã‚‹ã®ã§å¯¾ç­–ã—ã¦ãŠã
                    int questionLength = snapshot.data!.size;//å•é¡Œã®Listã®é•·ã•ã‚’å…ˆã«å–å¾—ã™ã‚‹
                    print("questionLength:$questionLength");
                    print("question_id:${snapshot.data!.docs[currentQuestionIndex].get("question_id")}");
                    print("currentQuestionIndex:$currentQuestionIndex");
                    return Column(
                      children: [
                        Container(
                            width: double.infinity,
                            padding: const EdgeInsets.only(top: 40),
                            child: Center(
                                child: Text(isAnswered ? "" : "${currentQuestionIndex + 1} å•ç›®",
                                  style: const TextStyle(fontSize: 30),)
                            )),
                        Container(
                            color: AppColors.mainBlue,
                            width: double.infinity, height: size.height * 0.28,
                            child: Center(
                              //questionã®ã‚¿ã‚¤ãƒˆãƒ«
                              child: isAnswered
                                  ? Container(height: 150,
                                  child: Image.asset(
                                    //TODO:æ­£è§£ã¨ä¸æ­£è§£ã®Imageã‚’ä½œã£ã¦è²¼ã‚Šä»˜ã‘ã‚‹ã€‚ä¸€æ—¦ã¯pngã§ä½œã‚‹
                                      isCorrect ?
                                      'images/main_image.png':
                                      'images/main_image.png'
                                  ))
                                  : Text(snapshot.data!.docs[currentQuestionIndex].get("title"),
                                  style: TextStyle(fontSize: 26)),
                            )
                        ),
                        Expanded(
                          child: Container(
                            padding: EdgeInsets.fromLTRB(12,12,12,0),
                            child: FutureBuilder<QuerySnapshot>(
                                future: answerFuture,
                                builder: (context, snapshot) {
                                  if(snapshot.hasData) {
                                    return
                                      isAnswered == false ? //æœªè§£ç­”çŠ¶æ…‹ã®æ™‚
                                      GridView.count(
                                          physics: const NeverScrollableScrollPhysics(),
                                          //ä¸Šè¨˜ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å›ºå®š
                                          crossAxisCount: 2,
                                          mainAxisSpacing: 24,
                                          crossAxisSpacing: 24,
                                          children: List.generate(4, (index) => GestureDetector(
                                            onTap: () async{
                                              //Tapæ™‚ã«å…ˆã«ã‚„ã‚‹ã“ã¨ã¯æ­£èª¤åˆ¤å®šã‚’è¡Œã†ã“ã¨
                                              if(index.toString() == snapshot.data!.docs[currentQuestionIndex].get("correct_answer_index_number")){
                                                //æ­£ç­”æ™‚
                                                ref.read(isCorrectProvider.notifier).state = true;
                                                ref.read(numberOfCorrectAnswersProvider.notifier).state++;//æ­£ç­”æ•°ã‚’+1
                                              }
                                              if(index.toString() != snapshot.data!.docs[currentQuestionIndex].get("correct_answer_index_number")){
                                                //ä¸æ­£ç­”æ™‚
                                                ref.read(isCorrectProvider.notifier).state = false;
                                              }
                                              if(ref.read(currentQuestionIndexProvider) < questionLength - 1){
                                                //å›ç­”é¡ŒãŒæœ€å¾Œã®å•é¡Œã§ã¯ãªã„æ™‚â†’å›ç­”ã—ã¦æ¬¡ã®å•é¡Œã¸
                                                ref.read(buttonProvider.notifier).state = true;
                                                //è§£ç­”çŠ¶æ…‹(isAnswered)ã‚’false => trueã«ã™ã‚‹å‡¦ç†ã€‚
                                                ref.read(currentQuestionIndexProvider.notifier).state++;
                                              }
                                              if(currentQuestionIndex == questionLength - 1){
                                                //å›ç­”é¡ŒãŒæœ€å¾Œã®å•é¡Œã®æ™‚â†’Resultç”»é¢ã¸
                                                Navigator.pushReplacement(context, MaterialPageRoute(
                                                    builder: (context)=> QuestionResultPage(
                                                        questionLength: currentQuestionIndex + 1,
                                                        numberOfCorrectAnswers: ref.read(numberOfCorrectAnswersProvider)
                                                    ))
                                                );
                                                ref.refresh(currentQuestionIndexProvider.notifier).state;
                                              }
                                              print(ref.read(numberOfCorrectAnswersProvider));
                                            },
                                            child: Card(
                                                shape: RoundedRectangleBorder(
                                                  borderRadius: BorderRadius.circular(10),
                                                ),
                                                color: AppColors.mainWhite,
                                                elevation: 5,
                                                child: Center(
                                                    child: Text('${snapshot.data!.docs[currentQuestionIndex].get("answer${index + 1}")}', style: AppTextStyles.textBold)
                                                )
                                            ),
                                          ))
                                      ) :
                                      GestureDetector(//è§£ç­”ã™ã‚‹ã¨
                                        onTap: (){
                                          ref.read(buttonProvider.notifier).state = false;
                                        },
                                        child: Center(
                                            child: Column(
                                              mainAxisAlignment: MainAxisAlignment.start,
                                              children: [
                                                Expanded(
                                                  child: Container(
                                                    padding: EdgeInsets.fromLTRB(20, 0, 20, 50),
                                                    child: Center(
                                                        child: Text(
                                                          "${snapshot.data!.docs[currentQuestionIndex - 1].get("commentary")}",
                                                          //ã“ã®å‡¦ç†ã‚ˆã‚Šå…ˆã«questionCounterãŒ++ã•ã‚Œã¦ã—ã¾ã†ã®ã§-1ã—ã¦ãŠãã“ã¨ã§å¸³å°»åˆã‚ã›ã‚‹ã€‚
                                                          style: TextStyle(fontSize: 22),)),
                                                    color: AppColors.subGreen,
                                                  ),
                                                ),
                                              ],
                                            )),
                                      );
                                  } else {
                                    return Container();
                                  }
                                }
                            ),
                          ),
                        )
                      ],
                    );
                  } else {
                    return const NormalCircularIndicator();
                  }
                }
            ),
          ),
        );
      })
    );
  }
}
```
