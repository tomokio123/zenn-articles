---
title: "[Flutter]Providerã¨StatefulWidgetã®é•ã„ã«ã¤ã„ã¦ã®å€‹äººçš„ã¾ã¨ã‚"
emoji: "ğŸ“"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Flutter","Dart"]
published: true
---
### å‰æï¼šçŠ¶æ…‹ç®¡ç†ã¨ã¯
- å¤‰æ•°ã‚„ç”»é¢ã«å¤‰æ›´ãŒã‚ã£ãŸéš›ã«ãã‚Œã‚’æ¤œçŸ¥ã™ã‚‹ä»•çµ„ã¿ã€‚

# StatefulWidgetã®ç¢ºèª
- **çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹Stateã‚¯ãƒ©ã‚¹ã‚’æŒã¤**
- `setState()`**ã‚’å‘¼ã¶ã“ã¨ã§å¤‰æ•°ãŒæ›´æ–°ã•ã‚Œã€å†buildã•ã‚Œã‚‹**
- å†æç”»ç¯„å›²ã¯ãã®`setState()`ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ã€‚ã“ã“ã§ã¯`_MyHomePageState`ã‚¯ãƒ©ã‚¹ã€‚
- StatefulWidgetã§å®šç¾©ã—ãŸå¤‰æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã„å ´åˆã¯ã€`widget.å¤‰æ•°å`ã¨ã™ã‚‹ã“ã¨ã§å¯èƒ½

## Sample code(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒª)
```dart:main.dart
import 'package:flutter/material.dart';

void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: MyHomePage(title: 'Flutter Demo Home Page'),
    );
  }
}

class MyHomePage extends StatefulWidget {
  MyHomePage({Key? key, required this.title}) : super(key: key);

  final String title;

  @override
  _MyHomePageState createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage> {
  int _counter = 0;

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text(widget.title),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            Text(
              'You have pushed the button this many times:',
            ),
            Text(
              '$_counter',
              style: Theme.of(context).textTheme.headline4,
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: _incrementCounter,
        tooltip: 'Increment',
        child: Icon(Icons.add),
      ), 
    );
  }
}
```

# ä»£ã‚ã‚Šã«Providerã‚’ä½¿ã†ã¨ã©ã†ãªã‚‹ï¼Ÿ(StatelessWidgetã‚’ä½¿ã†)
1. å¤‰æ›´ã‚’æ¤œçŸ¥ã™ã‚‹`_incrementCounter()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’`class CounterStore with ChangeNotifier`ã®ä¸­ã«ä¸€æ—¦å…¥ã‚Œã‚‹(ChangeNotifierã‚¯ãƒ©ã‚¹ã‚’Mix-inã—ãŸ)ã€‚
ã¾ãŸã€`notifyListeners();`ã¯`setState()`ã¨åŒã˜æ„Ÿã˜ã§ã€**å¤‰æ›´ã‚’èª­ã¿å–ã‚‹**

2. `create: (context) => CounterStore(),`ã®éƒ¨åˆ†ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã§ã€`class CounterStore with ChangeNotifier`ã‚’ä½¿ãˆã‚‹ã€‚

3. Scaffoldã‚’`ChangeNotifierProvider`ã§ãƒ©ãƒƒãƒ—(Providerã‚’ä½¿ã†ãŸã‚ã®æ±ºã¾ã‚Šæ–‡å¥)

4. `final store = Provider.of<CounterStore>(context);`ã§CounterStoreã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€`final _counter = store._counter;`ã§å¤‰æ•°ã‚’å–å¾—ã€‚

5. CounterStoreã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã‚ã‚‹store(ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å–ã‚Šå‡ºã—ãŸï¼

6. `Consumer()`ã§**å›²ã‚“ã ç¯„å›²ã ã‘ãŒå†æç”»ã•ã‚Œã‚‹**ã®ã§**ç„¡é§„ãªå†æç”»ã‚’é¿ã‘ã‚Œã‚‹**

```dart:main.dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';  // å¤‰æ›´ç®‡æ‰€ Providerã‚’ä½¿ã†ãŸã‚ã®import

// å¤‰æ›´ç®‡æ‰€
class CounterStore with ChangeNotifier {
  //â‘ ï¼šclass CounterStore with ChangeNotifierã®ä¸­ã«ä¸€æ—¦å…¥ã‚Œã‚‹
  int _counter = 0;
  //â‘ ï¼šå¤‰æ›´ã‚’æ¤œçŸ¥ã™ã‚‹_incrementCounter()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’
  void _incrementCounter() {   
    _counter++;
    notifyListeners();//setstate()ã¨ã»ã¼åŒç¾©
    //ã‚‚ã—notifyListeners()ãŒç„¡ãã€_counter++;ã ã‘ã®è¨˜è¿°ã®å ´åˆã€
    //å†…éƒ¨çš„ãªæ•°å€¤ã¯å¢—åŠ ã™ã‚‹ãŒã€ãã®å€¤ã®å¤‰æ›´ã«ã‚ˆã‚‹ç”»é¢ã®å†æç”»ã¯ã•ã‚Œãªã„ã®ã§
    //_counterã®å€¤ã¯ç”»é¢ä¸Šã§ã¯ä¸å¤‰ã€‚
  }
}

class MyHomePage extends StatelessWidget {
  MyHomePage({Key key, this.title}) : super(key: key);
  final String title;

  @override
  Widget build(BuildContext context) {
   // â‘¢ï¼šScaffoldã‚’`ChangeNotifierProvider`ã§ãƒ©ãƒƒãƒ—(Providerã‚’ä½¿ã†ãŸã‚ã®æ±ºã¾ã‚Šæ–‡å¥)
    return ChangeNotifierProvider(
      //â‘¡ã€€create: (context) => CounterStore(),ã®éƒ¨åˆ†ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã§
      //   class CounterStore with ChangeNotifierãŒæœ‰åŠ¹ã«ãªã‚‹ã€‚
        create: (context) => CounterStore(),
        child: Consumer(builder: (BuildContext context) {
          //Builder()ã‚ˆã‚ŠConsumer()ã®æ–¹ãŒè‰¯ã„ã£ã½ã„ã€‚ï¼Ÿ
          //â‘¥ï¼šConsumer()ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§å›²ã£ãŸéƒ¨åˆ†ã ã‘ãŒå†æç”»ã•ã‚Œã‚‹ã®ã§
          //ç„¡é§„ãªå†æç”»ã‚’é¿ã‘ã‚Œã‚‹ï¼
          final store = Provider.of<CounterStore>(context);
          //â‘£ï¼šCounterStoreã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—store(ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)ã«ã¶ã¡è¾¼ã‚€ã€‚
          final _counter = store._counter;
          //storeã«ã¶ã¡è¾¼ã‚“ã ä¸­ã‹ã‚‰å¤‰æ•°(_counter)ã‚’å–å¾—ã—ã€_counterã«å†ä»£å…¥ã€‚
          //(ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘çš„ã«ã„ã†ã¨ã€ã€ŒåŒã˜å ´æ‰€ã‚’å‚ç…§ã™ã‚‹ã€ã£ã¦æ„å‘³ã‹ãª)ã€‚
          return Scaffold(
            appBar: AppBar(
              title: Text(title),  //widget.title â†’ title
            ),
            body: Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: <Widget>[
                  Text(
                    'You have pushed the button this many times:',
                  ),
                  Text(
                    '$_counter',
                    style: Theme.of(context).textTheme.headline4,
                  ),
                ],
              ),
            ),
            floatingActionButton: FloatingActionButton(
              onPressed: store._incrementCounter,  
              // â‘¤ï¼šstoreã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«è©°ã‚è¾¼ã‚“ã _incrementCounterãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¼•ã£å¼µã£ã¦ãã‚‹ï¼
              tooltip: 'Increment',
              child: Icon(Icons.add),
            ),
          );
        }));
  }
}
```
[å‚è€ƒè¨˜äº‹](https://qiita.com/yusuke_vp/items/58b478e20f407cdddc6c)
[å‚è€ƒè¨˜äº‹](https://gakogako.com/flutter_provider/#Provider%E3%81%AE%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88)
[å‚è€ƒè¨˜äº‹](https://medium.com/flutter-jp/state-performance-7a5f67d62edd)
# StatefulWidgetã¨ã®é•ã„ã¨Provioderã®åˆ©ç‚¹

1. **Provider**ã«ã™ã‚‹ã¨ã€UIã‚’è¡¨ç¤ºã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«(View)ã¨è£å´ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç®¡ç†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«(model)ã«åˆ†ã‘ãŸãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆãŒå¯èƒ½ã€‚MVVMè¨­è¨ˆã€‚ã¤ã¾ã‚Š**å½¹å‰²ã®æ£²ã¿åˆ†ã‘ãŒè‡ªç„¶ã«ã§ãã¦å¯èª­æ€§ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ãŒå‘ä¸Š**ã€‚

<br>

2. ç„¡é§„ãªå†æç”»ã‚’æ¸›ã‚‰ã›ã‚‹
    - **statefulWidget**ï¼š**ç”»é¢ã®å°ã•ãªçŠ¶æ…‹å¤‰åŒ–ã§ã‚‚ç”»é¢å…¨ã¦ã®Widgetã‚’ï¼‘ã‹ã‚‰ä¸Šã‹ã‚‰é †ã«æ›´æ–°**ã™ã‚‹
      - ç´°ã‹ãè¨€ã†ã¨ã€setStateãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ãã®**classå†…ã«ã‚ã‚‹buildé–¢æ•°ä»¥å†…å…¨ã¦ã®Widgetã‚’å†æç”»**ã™ã‚‹ã€‚ç„¡é§„ãªå†æç”»ãŒå¢—ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚
      - **ãã®ã‚¯ãƒ©ã‚¹å†…ã§UIã‚’æ§‹ç¯‰ã™ã‚‹å‡¦ç†ã¨çŠ¶æ…‹ç®¡ç†ã™ã‚‹å‡¦ç†ã‚’è¨˜è¿°ã™ã‚‹å¿…è¦**ãŒã‚ã‚Šã€å„ç”»é¢ã§çŠ¶æ…‹ã‚’å…±æœ‰ã—ãŸã„å ´åˆã«ã¯å‘ã„ã¦ã„ãªã„ã€‚

    - **Provider**ï¼š**å†æç”»ã—ãŸã„ç¯„å›²ã‚’è‡ªåˆ†ã§çµã£ã¦æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã€ç„¡é§„ãªå†æç”»ã‚’å‰Šæ¸›**ã§ãã‚‹ã€‚
      - **å†æç”»ã—ãŸã„ç®‡æ‰€ã ã‘Consumer()ã§å›²ã¿ã€notifyListeners()ã§å†æç”»ã•ã‚Œã‚‹**


<br>
***

ä»¥ä¸Šã§ã™ã€‚é–“é•ãˆãŒè¦‹ã¤ã‹ã‚Šæ¬¡ç¬¬ã€æˆ–ã„ã¯çŸ¥è­˜ãŒã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œæ¬¡ç¬¬æ”¹è¨‚ã—ã¦ã„ãã¾ã™ã€‚ğŸ™

å€‹äººçš„ã«ã¯ã‚„ã£ã±ã‚ŠWidgetçŠ¶æ…‹ã¯Statelessã§ã€çŠ¶æ…‹å¤‰åŒ–ã¯Provider,RiverPodã§è¡Œã†ã€‚ã¨ã„ã†ç·šå¼•ãã‚’ã—ã‚ˆã†ã¨æ€ã£ãŸã€‚

ã¾ãŸå†æç”»ç¯„å›²ã®ãƒ©ãƒƒãƒ—ã‚’Consumer()ã§ã—ãŸã‘ã©ã€ä»–ã«Builder()ã¨ã‹ã§åŒ…ã‚€ã®ã‚‚å¤§ä¸ˆå¤«ãªã®ã‹ï¼Ÿã¨æ€ã£ãŸã‹ã‚‰èª¿æŸ»è¦