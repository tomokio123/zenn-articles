---
title: "[Flutter]Validationã‚’ç”¨ã„ãŸformã‚’ä½œã‚‹"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Flutter","Dart"]
published: true
---
å‚è€ƒè¨˜äº‹ã¯ä»¥ä¸‹
[Build a form with validation](https://docs.flutter.dev/cookbook/forms/validation)

- å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã®ãƒšãƒ¼ã‚¸ã‚’ä¸¸ã€…å™›ã¿ç •ãã®ã‚‚ã„ã„ãŒã€ã€Œãªãœãã‚Œã‚’äº‹å‰å®šç¾©ã™ã‚‹ï¼Ÿã€ãªã©ã€ç–‘å•ã«æ€ã„ãŒã¡ãªç‚¹ã‚’ä»˜ã‘åŠ ãˆã¦ã„ã
# Validationã¨ã¯
- å…¥åŠ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã€Œä¸æ­£ãªæ›¸ãæ–¹ã˜ã‚ƒãªã„ï¼Ÿã€ã€Œå¤‰ãªæ–‡å­—ä½¿ã£ã¦ãªã„ï¼Ÿã€ã‹ã‚’èª¿ã¹ã¦ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºãªã©ã‚’ã™ã‚‹ã“ã¨
# Validationã‚’ç”¨ã„ãŸformã®ä½œã‚Šæ–¹
## 1. GlobalKeyã§formã‚’ä½œã‚‹
é‡è¦ãªã®ã¯`final _formKey = GlobalKey<FormState>();`ä»¥ä¸‹
- `GlobalKey<FormState>()`ã‚’æŒãŸã›ãŸ_formKeyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
- ç®¡ç†ã—ãŸã„å ´æ‰€ã«keyãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­ç½®ã—ã¦è¦ªã¯`Form`(ç³»)Widget(ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã€Œkeyã€ã‚’ã¨ã‚Œã‚‹ã‚‚ã®)ã«ã™ã‚‹ã€‚
```dart:main.dart
import 'package:flutter/material.dart';
class MyCustomForm extends StatefulWidget {
  const MyCustomForm({super.key});

  @override
  MyCustomFormState createState() {
    return MyCustomFormState();
  }
}
class MyCustomFormState extends State<MyCustomForm> {
  final _formKey = GlobalKey<FormState>();//å®šç¾©ã—ã¦

  @override
  Widget build(BuildContext context) {
    return Form(
      key: _formKey,//ç®¡ç†ã—ãŸã„å ´æ‰€ã«keyãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­ç½®
      child: Column(
        children: <Widget>[
          // Add TextFormFields and ElevatedButton here.
        ],
      ),
    );
  }
}
```
## 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å‡¦ç†ã‚’æŒãŸã›ãŸTextFormField Widgetã‚’ç”¨æ„ã™ã‚‹
- ä¸Šè¨˜â‘ ã®`Form` Widgetä»¥ä¸‹ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å‡¦ç†ã‚’æŒãŸã›ãŸ`TextFormField` Widgetã‚’ç”¨æ„
```dart
TextFormField(
  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’æŒãŸã›ãŸTextFormField(ç³»)Widgetã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰(è¨˜å…¥æ¬„)ã‚’
  //â‘ ã®ã€Œform Widgetã€ã®å­ä¾›ã«ã‚‚ãŸã›ã‚‹
  validator: (value) {
    //ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒnull or ç©ºã®çŠ¶æ…‹ãªã‚‰ã€Œè‰¯ããªã„ã‚ˆã€è¨˜å…¥ã—ã‚ã‚ˆã€ã£ã¦æ€’ã‚‹ã‚ˆã†ã«ã—ã¨ãã€‚
    if (value == null || value.isEmpty) {
      return 'Please enter some text';
    }
    return null;
    //ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ãŒæœ‰åŠ¹ã®å ´åˆã€ã™ãªã‚ã¡Stringã‚¨ãƒ©ãƒ¼ãŒãªã„å ´åˆã€ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã¯ null ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚‹ã€‚
    //validatorã¯ã€Œç•°å¸¸ãªã„ã‹æ¤œçŸ¥ã€ã™ã‚‹ä»•çµ„ã¿ãªã®ã§ã©ã®ç•°å¸¸ã«ã‚‚ãªã‚‰ã‚“ã‹ã£ãŸã‚‰ã€Œç•°å¸¸ãªã— = nullã€ã‚’è¿”ã™
  },
),
```
## 3. formã®å†…å®¹ã‚’ãƒãƒªãƒ‡ãƒ¼ãƒˆ(æ¤œè¨¼)çµæœã«æ²¿ã£ã¦é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã™ã‚‹
- é€ä¿¡ãƒœã‚¿ãƒ³æŠ¼ã—ãŸæ™‚ã«æ¤œè¨¼æ¸ˆã¿ãªã‚‰ifå†…ã®å‡¦ç†ãŒèµ°ã‚‹ã‚ˆã†ã«ã™ã‚‹
```dart
ElevatedButton(
  onPressed: () {
    // isValid(æ¤œè¨¼ãšã¿)ã‹ã©ã†ã‹ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹ã€‚
    if (_formKey.currentState!.validate()) {
      //_formKeyã®currentStateãŒæ¤œè¨¼æ¸ˆã¿ãªã‚‰ã€ä»¥ä¸‹ã®å‡¦ç†ã€‚ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã§ã€ŒæˆåŠŸã—ãŸã‚ˆã€ã£ã¦å‡ºã™ã€‚
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('Processing Data')),
      );
    }
  },
  child: const Text('Submit'),
),
```
- SnackBarï¼šä¸€èˆ¬ã«ç”»é¢ä¸‹ãªã©ã‹ã‚‰å‡ºã¦ãã‚‹ã€ŒæˆåŠŸã—ã¾ã—ãŸã€ã€Œãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã›ã‚“ã§ã—ãŸã€çš„ãªãƒˆãƒ¼ã‚¹ãƒˆ(ãƒ­ã‚°)ã®ã“ã¨
â†’å®Ÿéš›ã«è¡¨ç¤ºã™ã‚‹WidgetãŒã“ã‚Œ
- ScaffoldMessengerï¼šå­Widgetä»¥ä¸‹ã§Scaffoldã®SnackBarãªã©ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚¯ãƒ©ã‚¹ã€‚
- currentStateãƒ¡ã‚½ãƒƒãƒ‰ï¼šGlobalKeyã‚’æŒã£ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ(ã“ã“ã§ã¯_formKey)ãŒå®šç¾©ã•ã‚Œã¦ã‚‹Widget(ã‚¯ãƒ©ã‚¹)ä»¥ä¸‹ã®çŠ¶æ…‹ã‚’ã‚‚ã¤ã€‚ä»¥ä¸‹ã§è§£èª¬

# ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
- å…¬å¼å¼•ç”¨ã€é‡è¦ãªã®ã¯â‘ â‘¡â‘¢ã®éƒ¨åˆ†
```dart:main.dart
import 'package:flutter/material.dart';

void main() => runApp(const MyApp());

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    const appTitle = 'Form Validation Demo';

    return MaterialApp(
      title: appTitle,
      home: Scaffold(
        appBar: AppBar(
          title: const Text(appTitle),
        ),
        body: const MyCustomForm(),
      ),
    );
  }
}
class MyCustomForm extends StatefulWidget {
  const MyCustomForm({super.key});

  @override
  MyCustomFormState createState() {
    return MyCustomFormState();
  }
}
class MyCustomFormState extends State<MyCustomForm> {
  final _formKey = GlobalKey<FormState>();//â‘ ï¼šå®šç¾©

  @override
  Widget build(BuildContext context) {
    return Form(
      key: _formKey,
      //â‘ ï¼šformã®keyãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒãŸã›ã‚‹ã€‚ã“ã“ä»¥ä¸‹ã®Widgetã‚’ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          TextFormField(
            //â‘¡ï¼šãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å‡¦ç†ã‚’æŒãŸã›ãŸTextFormField Widgetã‚’ç”¨æ„ã™ã‚‹
            validator: (value) {
              if (value == null || value.isEmpty) {
                return 'Please enter some text';
              }
              return null;
            },
          ),
          Padding(
            padding: const EdgeInsets.symmetric(vertical: 16.0),
            child: ElevatedButton(
              onPressed: () {
                //â‘¢ï¼šformã®å†…å®¹ã‚’ãƒãƒªãƒ‡ãƒ¼ãƒˆ(æ¤œè¨¼)ã—ã¦é€ä¿¡ã™ã‚‹ãŸã‚ã®ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã™ã‚‹
                if (_formKey.currentState!.validate()) {
                  ScaffoldMessenger.of(context).showSnackBar(
                    const SnackBar(content: Text('Processing Data')),
                  );
                }
              },
              child: const Text('Submit'),
            ),
          ),
        ],
      ),
    );
  }
}
```

***
# ç–‘å•ç‚¹ã¨è€ƒå¯Ÿ 
## 1. GlobalKeyã£ã¦ï¼Ÿ
[Keyã«ã¤ã„ã¦ã®å‚è€ƒè¨˜äº‹](https://qiita.com/kurun_pan/items/0517fb62f1b47c90882c)
[å…¬å¼GlobalKey Class](https://api.flutter.dev/flutter/widgets/GlobalKey-class.html)
>ã€ŒFormã‚’ä¸€æ„ã«è­˜åˆ¥ã§ãã‚‹ã‚‚ã®ã€

ã£ã¦è¨€ã‚ã‚Œã¦ã‚‚ãƒ”ãƒ³ã¨ã“ãªã„ã®ã§è¨€ã„æ›ãˆã‚‹
- ã€Œ**ã‚¢ãƒ—ãƒªå…¨ä½“ã®ã©ã“ã‹ã‚‰ã§ã‚‚(ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«)ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆã§æŒ‡ã•ã›ã‚‹ãƒãƒ¼ã‚¯**ã€çš„ãªæ„Ÿã˜ã®ã‚‚ã®

åå¯¾ã«
**LocalKey**ã¨ã¯
- ã€Œ**ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä»¥ä¸‹ã§ã—ã‹æŒ‡ã•ã›ãªã„ãƒãƒ¼ã‚¯**ã€çš„ãªæ„Ÿã˜

ä¸Šã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚‚ã€ã‚‚ã— `final _formKey = LocalKey <FormState>()`ã§å®šç¾©ã—ã¦ã„ãŸã‚‰
`key: _formKey,`ã‚’å®šç¾©ã—ãŸwidgetã¨ãã®å­widgetä»¥å¤–ã‹ã‚‰ã¯æ­£ç¢ºã«çŠ¶æ…‹ã‚’æŒ‡ã—ç¤ºã™ã“ã¨ã¯ã§ããªããªã‚‹ã€‚
ãã“ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«orãƒ­ãƒ¼ã‚«ãƒ«ã®åˆ¤æ–­ã¯çŠ¶æ…‹ã‚’æŠŠæ¡ã—ãŸã„ç¯„å›²ã‚„ã‚³ã‚¹ãƒˆã«ã‚ˆã‚‹

## 2. currentStateãƒ¡ã‚½ãƒƒãƒ‰ã¨ã¯ï¼Ÿã€€

- GlobalKeyã‚’æŒã¤ãƒ„ãƒªãƒ¼å†…ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ç¾åœ¨ã®çŠ¶æ…‹ã‚’ã¨ã£ã¦ãã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã€‚
  1. ã“ã®GlobalKeyã«ä¸€è‡´ã™ã‚‹ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒãƒ„ãƒªãƒ¼å†…ã«ãªã„å ´åˆã€è¦ã™ã‚‹ã«ã€Œ**ã‚­ãƒ¼ã‚’æŒ‡ã•ã›ãªã„å ´åˆ**ã€
  2. ãã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒ StatefulWidget ã§ãªã„å ´åˆã€è¦ã™ã‚‹ã«ã€Œ**statefulWidget or çŠ¶æ…‹ç®¡ç†ã§ãã‚‹Widget ã§ã¯ãªã„å ´åˆ**ã€

  ã“ã®äºŒã¤ã®å ´åˆã§ currentState = null ã«ãªã‚‹ï¼

ã¾ãŸã€

- ### ãªãœã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã€Œ!ã€ã§nullã˜ã‚ƒãªã„ã£ã¦æ–­è¨€ã—ã¦ã‚‹ã®ï¼Ÿ

â†’**â‘¡ã®ãƒãƒªãƒ‡ãƒ¼ãƒˆã§ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç©ºã®å ´åˆã‚„nullãªã‚‰å¼¾ã‹ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚‹**ã‹ã‚‰ã€â‘¢ã§ã¯`.currentState!`(nullã¯ã‚ã‚Šå¾—ãªã„ã‚ˆï¼)ã¨ã—ã¦ã‚‹ã€‚
***

# æ‰€æ„Ÿ
Keyã«ã¤ã„ã¦ç†è§£ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨ã—ã¦ã¯è‰¯ã‹ã£ãŸã€‚
ã€Œã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆãƒ„ãƒªãƒ¼(çŠ¶æ…‹ã‚’å¸ã‚‹)ã‹ã‚‰widgetãƒ„ãƒªãƒ¼ã‚’ä¸€æ„ã«æŒ‡ã—ç¤ºã™ã€ã®ãŒå¤šåˆ†å³å¯†ãªè¨€ã„æ–¹ã§ã€statefulãªçŠ¶æ…‹ç®¡ç†ã‚‚çµ¡ã‚“ã§ãã‚‹ã®ã§è‡ªåˆ†ã‚‚ã‚ˆãã‚ã‹ã£ã¦ãªã„ç¯€ãŒã‚ã‚Šã¾ãã‚‹ãŒã€å‚è€ƒã«ãªã‚Œã°å¬‰ã—ã„ã§ã™ğŸ™‡â€â™‚ï¸